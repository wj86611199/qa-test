[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
logfile_maxbytes=50MB
logfile_backups=10
loglevel=info
pidfile=/var/run/supervisord.pid

[unix_http_server]
file=/var/run/supervisor.sock
chmod=7777
username=supervisor
password=supervisor

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock
username=supervisor
password=supervisor

[rpcinterface:supervisor]
supervisor.rpcinterface_factory=supervisor.rpcinterface:make_main_rpcinterface

# Xvfb虚拟显示服务
[program:xvfb]
command=Xvfb :1 -screen 0 %(ENV_RESOLUTION)s -ac +extension GLX +render -noreset
autorestart=true
priority=10
stdout_logfile=/var/log/supervisor/xvfb.log
stderr_logfile=/var/log/supervisor/xvfb-error.log
stdout_logfile_maxbytes=50MB
stderr_logfile_maxbytes=50MB
stdout_logfile_backups=10
stderr_logfile_backups=10

# x11vnc服务
[program:x11vnc]
command=x11vnc -display :1 -rfbport %(ENV_VNC_PORT)s -forever -shared -localhost=0 -nopw
autorestart=true
priority=15
stdout_logfile=/var/log/supervisor/x11vnc.log
stderr_logfile=/var/log/supervisor/x11vnc-error.log
stdout_logfile_maxbytes=50MB
stderr_logfile_maxbytes=50MB
stdout_logfile_backups=10
stderr_logfile_backups=10

# Websockify服务
[program:websockify]
command=websockify --web /usr/share/novnc %(ENV_NO_VNC_PORT)s localhost:%(ENV_VNC_PORT)s
autorestart=true
priority=20
stdout_logfile=/var/log/supervisor/websockify.log
stderr_logfile=/var/log/supervisor/websockify-error.log
stdout_logfile_maxbytes=50MB
stderr_logfile_maxbytes=50MB
stdout_logfile_backups=10
stderr_logfile_backups=10

# 窗口管理器
[program:openbox]
command=openbox-session
environment=DISPLAY=:1
autorestart=true
priority=15
stdout_logfile=/var/log/supervisor/openbox.log
stderr_logfile=/var/log/supervisor/openbox-error.log
stdout_logfile_maxbytes=50MB
stderr_logfile_maxbytes=50MB
stdout_logfile_backups=10
stderr_logfile_backups=10

# Node.js服务（如果需要）
[program:node]
command=bash -c "cd /server && npm run start"
autorestart=true
priority=30
stdout_logfile=/var/log/supervisor/node.log
stderr_logfile=/var/log/supervisor/node-error.log
stdout_logfile_maxbytes=50MB
stderr_logfile_maxbytes=50MB
stdout_logfile_backups=10
stderr_logfile_backups=10
